<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>تحليل جدوى عقار</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f6fbf6;
      --card: #ffffff;
      --text: #1f2d27;
      --muted: #5f6c64;
      --accent: #1f8f68;
      --accent-2: #f3c969;
      --border: #e2e8e2;
      --shadow: 0 14px 30px rgba(31, 143, 104, 0.08);
      --radius: 14px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'IBM Plex Sans Arabic', system-ui, sans-serif;
      background: linear-gradient(140deg, #f9fdf8 0%, #f3f9f2 45%, #fdfbf4 100%);
      color: var(--text);
      direction: rtl;
      padding: 24px;
    }

    h1 {
      margin: 0 0 6px;
      font-size: 1.75rem;
      font-weight: 700;
    }

    p.lead {
      margin: 0 0 16px;
      color: var(--muted);
    }

    .page {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .layout {
      display: grid;
      grid-template-columns: 1.9fr 2.5fr;
      gap: 18px;
      align-items: start;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px 18px 20px;
      box-shadow: var(--shadow);
    }

    .card h2 {
      margin: 0 0 12px;
      font-size: 1.1rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .inputs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px 16px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    label {
      font-weight: 600;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .input-wrap {
      display: flex;
      align-items: center;
      background: #f9fbf9;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 10px;
      gap: 8px;
    }

    .input-wrap input {
      border: none;
      background: transparent;
      font-size: 1rem;
      width: 100%;
      color: var(--text);
      outline: none;
      direction: ltr;
      text-align: right;
    }

    .unit {
      color: var(--muted);
      font-size: 0.9rem;
      white-space: nowrap;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(31, 143, 104, 0.08);
      color: var(--accent);
      border-radius: 999px;
      padding: 6px 10px;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .muted-box {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .muted-box .stat {
      background: #f8fbfa;
      border: 1px dashed var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.95rem;
    }

    .muted-box .stat strong {
      font-size: 1rem;
      color: var(--text);
    }

    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 8px;
    }

    .summary .item {
      background: #fdfefc;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .summary .item .label {
      color: var(--muted);
      font-size: 0.92rem;
    }

    .summary .item .value {
      font-weight: 700;
      font-size: 1.05rem;
      color: var(--text);
      direction: ltr;
    }

    .decision {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 12px;
      font-weight: 700;
      margin-top: 6px;
    }

    .decision.good {
      background: rgba(31, 143, 104, 0.12);
      color: var(--accent);
      border: 1px solid rgba(31, 143, 104, 0.2);
    }

    .decision.bad {
      background: rgba(243, 89, 89, 0.1);
      color: #c13c3c;
      border: 1px solid rgba(243, 89, 89, 0.2);
    }

    .table-card header,
    .inputs-card header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      appearance: none;
      border: none;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 700;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.1s ease, box-shadow 0.2s ease;
      box-shadow: 0 10px 20px rgba(31, 143, 104, 0.15);
      color: #0f553f;
      background: linear-gradient(135deg, var(--accent), #26a778);
    }

    .btn.secondary {
      background: #f7f9f8;
      color: var(--text);
      box-shadow: none;
      border: 1px solid var(--border);
    }

    .btn:active { transform: translateY(1px); }

    .table-wrapper {
      overflow: auto;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      box-shadow: var(--shadow);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1200px;
    }

    th, td {
      padding: 10px 12px;
      text-align: right;
      border-bottom: 1px solid var(--border);
      font-size: 0.95rem;
      white-space: nowrap;
    }

    thead th {
      position: sticky;
      top: 0;
      background: linear-gradient(180deg, #f4f8f4 0%, #fdfefc 100%);
      z-index: 1;
      font-weight: 700;
      color: var(--text);
    }

    tbody tr:hover {
      background: #f9fcf8;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--text);
      background: #f3f6f3;
      border: 1px solid var(--border);
    }

    .computed-block {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .computed-block .box {
      background: #f8fbfa;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .switcher {
      display: inline-flex;
      gap: 8px;
      padding: 6px;
      background: #f8fbfa;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .switcher button {
      border: none;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      background: transparent;
      color: var(--muted);
      transition: background 0.2s ease, color 0.2s ease;
    }

    .switcher button.active {
      background: rgba(31, 143, 104, 0.12);
      color: var(--accent);
    }

    .compact-hidden { display: table-cell; }
    .compact .compact-hidden { display: none; }

    .sticky-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .helper-text {
      font-size: 0.92rem;
      color: var(--muted);
    }

    @media (max-width: 992px) {
      body { padding: 18px; }
      .layout { grid-template-columns: 1fr; }
      .inputs-card { order: -1; }
      table { min-width: 1000px; }
    }

    @media (max-width: 600px) {
      body { padding: 14px; }
      h1 { font-size: 1.4rem; }
      .btn { width: 100%; justify-content: center; }
      .sticky-actions { width: 100%; }
      .table-card header { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>تحليل جدوى عقار (توقعات سنوية)</h1>
      <p class="lead">عدّل المدخلات لترى الأثر مباشرة على التدفقات النقدية والعوائد.</p>
    </header>

    <div class="layout">
      <section class="card table-card">
        <header>
          <div>
            <h2>النتائج المتوقعة</h2>
            <p class="helper-text">تصفح السنوات وشاهد ترويسة الجدول ثابتة أثناء التمرير.</p>
          </div>
          <div class="sticky-actions">
            <div class="switcher" aria-label="تبديل عرض الجدول">
              <button type="button" data-view="full" class="active">عرض كامل</button>
              <button type="button" data-view="compact">عرض مختصر</button>
            </div>
            <button class="btn secondary" id="exportCsv" type="button">تصدير CSV</button>
          </div>
        </header>

        <div class="card" style="margin-top:12px;">
          <h2>ملخص سريع</h2>
          <p class="helper-text">أرقام سنة البداية مع شارة قرار بناءً على DSCR والربح الشهري.</p>
          <div id="decision" class="decision">—</div>
          <div class="summary" id="summaryGrid"></div>
        </div>

        <div class="table-wrapper" id="tableWrapper" style="margin-top:14px;">
          <table id="resultsTable">
            <thead>
              <tr>
                <th>العام</th>
                <th>قيمة العقار</th>
                <th>الإيجار السنوي</th>
                <th>الإيجار الشهري</th>
                <th class="compact-hidden">القسط السنوي</th>
                <th>القسط الشهري</th>
                <th class="compact-hidden">صافي الربح السنوي</th>
                <th>صافي الربح الشهري</th>
                <th class="compact-hidden">العائد على المقدم</th>
                <th class="compact-hidden">NOI قبل القسط</th>
                <th>DSCR</th>
                <th>Break-even rent</th>
                <th>هامش الأمان الشهري</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="card inputs-card">
        <header>
          <h2>المدخلات</h2>
          <div class="sticky-actions">
            <button class="btn secondary" id="resetBtn" type="button">إعادة تعيين</button>
          </div>
        </header>

        <div class="inputs-grid" id="inputsGrid"></div>

        <div class="computed-block">
          <div class="box">
            <span class="label">مبلغ التمويل</span>
            <strong id="loanAmount" class="value" dir="ltr">—</strong>
          </div>
          <div class="box">
            <span class="label">الفائدة الشهرية (ريال)</span>
            <strong id="monthlyInterest" class="value" dir="ltr">—</strong>
          </div>
        </div>

        <div class="muted-box">
          <div class="stat">
            <span>ملاحظة</span>
            <strong>الأرقام محدثة فورًا</strong>
          </div>
          <div class="stat">
            <span>التنسيق</span>
            <strong>فواصل آلاف وأرقام إنجليزية</strong>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    const DSCR_THRESHOLD = 1.25;
    const debounceDelay = 150;

    const defaults = {
      capitalGrowth: 3.0,
      rentGrowth: 3.0,
      rentYield: 7.0,
      downPct: 30.0,
      downPayment: 120000,
      price0: 400000,
      rateAnnual: 3.4,
      termYears: 25,
      vacancy: 4.0,
      opexPct: 5.0,
      fixedAnnual: 0,
      startYear: 2026,
      endYear: 2050,
    };

    const fieldsConfig = [
      { key: 'capitalGrowth', label: 'النمو الرأسمالي المتوقع', unit: '%', step: '0.1' },
      { key: 'rentGrowth', label: 'النمو في الإيجارات', unit: '%', step: '0.1' },
      { key: 'rentYield', label: 'العائد التأجيري', unit: '%', step: '0.1' },
      { key: 'downPct', label: 'نسبة المقدم', unit: '%', step: '0.1' },
      { key: 'downPayment', label: 'الدفعة الأولى', unit: 'ريال', step: '100' },
      { key: 'price0', label: 'قيمة العقار', unit: 'ريال', step: '1000' },
      { key: 'rateAnnual', label: 'الفائدة السنوية', unit: '%', step: '0.01' },
      { key: 'termYears', label: 'مدة التمويل', unit: 'سنوات', step: '1' },
      { key: 'vacancy', label: 'نسبة الشغور/الفراغ', unit: '%', step: '0.1' },
      { key: 'opexPct', label: 'مصاريف تشغيل من الإيجار', unit: '%', step: '0.1' },
      { key: 'fixedAnnual', label: 'مصاريف ثابتة سنوية', unit: 'ريال', step: '100' },
      { key: 'startYear', label: 'سنة البداية', unit: '', step: '1' },
      { key: 'endYear', label: 'سنة النهاية', unit: '', step: '1' },
    ];

    const inputsGrid = document.getElementById('inputsGrid');
    const resultsTableBody = document.querySelector('#resultsTable tbody');
    const summaryGrid = document.getElementById('summaryGrid');
    const decisionEl = document.getElementById('decision');
    const loanAmountEl = document.getElementById('loanAmount');
    const monthlyInterestEl = document.getElementById('monthlyInterest');
    const exportBtn = document.getElementById('exportCsv');
    const resetBtn = document.getElementById('resetBtn');
    const switcher = document.querySelector('.switcher');
    const tableWrapper = document.getElementById('tableWrapper');

    let downLocked = false;
    let debounceTimer;

    const numberFormatter = (decimals = 0) => new Intl.NumberFormat('en-US', {
      minimumFractionDigits: decimals,
      maximumFractionDigits: decimals,
    });

    const fmt0 = numberFormatter(0);
    const fmt2 = numberFormatter(2);

    function createInputs() {
      fieldsConfig.forEach(cfg => {
        const field = document.createElement('div');
        field.className = 'field';

        const label = document.createElement('label');
        label.setAttribute('for', cfg.key);
        label.textContent = cfg.label + (cfg.unit ? ' (' + cfg.unit + ')' : '');

        const wrap = document.createElement('div');
        wrap.className = 'input-wrap';

        const input = document.createElement('input');
        input.id = cfg.key;
        input.name = cfg.key;
        input.type = 'number';
        input.step = cfg.step;
        input.value = defaults[cfg.key];
        input.dataset.key = cfg.key;
        if (cfg.key === 'downPayment') {
          input.disabled = true;
        }

        const unit = document.createElement('span');
        unit.className = 'unit';
        unit.textContent = cfg.unit || '';

        wrap.appendChild(input);
        wrap.appendChild(unit);
        field.appendChild(label);
        field.appendChild(wrap);
        inputsGrid.appendChild(field);

        if (cfg.key === 'downPayment') {
          const lockBtn = document.createElement('button');
          lockBtn.type = 'button';
          lockBtn.className = 'btn secondary';
          lockBtn.style.marginTop = '6px';
          lockBtn.id = 'lockBtn';
          lockBtn.textContent = 'قفل الدفعة الأولى';
          field.appendChild(lockBtn);
          lockBtn.addEventListener('click', () => {
            downLocked = !downLocked;
            input.disabled = !downLocked;
            lockBtn.textContent = downLocked ? 'فتح القفل (مقدم ثابت)' : 'قفل الدفعة الأولى';
            if (!downLocked) {
              syncDownPaymentFromPct();
            }
            triggerRecalc();
          });
        }
      });
    }

    function getInputValue(key) {
      const el = document.getElementById(key);
      return parseFloat(el.value || '0');
    }

    function syncDownPaymentFromPct() {
      const price = getInputValue('price0');
      const downPct = getInputValue('downPct') / 100;
      const value = price * downPct;
      const dpInput = document.getElementById('downPayment');
      dpInput.value = Math.round(value);
    }

    function syncDownPctFromPayment() {
      const price = getInputValue('price0');
      const dp = getInputValue('downPayment');
      const pct = price > 0 ? (dp / price) * 100 : 0;
      const pctInput = document.getElementById('downPct');
      pctInput.value = pct.toFixed(2);
    }

    function pmt(rate, nper, pv) {
      if (rate === 0) return -(pv / nper);
      const r1 = Math.pow(1 + rate, nper);
      return -(pv * rate * r1) / (r1 - 1);
    }

    function collectValues() {
      const vals = {};
      fieldsConfig.forEach(({ key }) => {
        vals[key] = getInputValue(key);
      });
      return vals;
    }

    function computeMonthlyInterest(loanAmount, rateAnnual) {
      return loanAmount * (rateAnnual / 100) / 12;
    }

    function computeRows(vals) {
      const {
        capitalGrowth, rentGrowth, rentYield,
        downPayment, downPct, price0, rateAnnual,
        termYears, vacancy, opexPct, fixedAnnual,
        startYear, endYear,
      } = vals;

      const years = [];
      const start = Math.min(startYear, endYear);
      const end = Math.max(startYear, endYear);
      const loanAmount = price0 - downPayment;
      const monthlyRate = rateAnnual / 100 / 12;
      const periods = termYears * 12;
      const monthlyPayment = pmt(monthlyRate, periods, loanAmount);
      const annualPayment = monthlyPayment * 12;

      const rentAnnual0 = price0 * (rentYield / 100);

      for (let y = start; y <= end; y++) {
        const idx = y - start;
        const price = price0 * Math.pow(1 + capitalGrowth / 100, idx);
        const rentAnnual = rentAnnual0 * Math.pow(1 + rentGrowth / 100, idx);
        const rentMonthly = rentAnnual / 12;

        const NOI = rentAnnual * (1 - vacancy / 100) - rentAnnual * (opexPct / 100) - fixedAnnual;
        const dscr = annualPayment !== 0 ? NOI / Math.abs(annualPayment) : 0;
        const netProfitAnnual = NOI - Math.abs(annualPayment);
        const netProfitMonthly = netProfitAnnual / 12;
        const returnOnDown = downPayment !== 0 ? netProfitAnnual / downPayment : 0;

        const breakEvenDenom = 1 - vacancy / 100 - opexPct / 100;
        const breakEvenMonthly = breakEvenDenom > 0 ? (Math.abs(monthlyPayment) + (fixedAnnual / 12)) / breakEvenDenom : null;

        years.push({
          year: y,
          price,
          rentAnnual,
          rentMonthly,
          annualPayment: Math.abs(annualPayment),
          monthlyPayment: Math.abs(monthlyPayment),
          netProfitAnnual,
          netProfitMonthly,
          returnOnDown,
          NOI,
          dscr,
          breakEvenMonthly,
          safetyMonthly: netProfitMonthly,
        });
      }
      return { rows: years, loanAmount, monthlyPayment, annualPayment };
    }

    function renderSummary(rows, monthlyPayment, annualPayment, downPayment) {
      summaryGrid.innerHTML = '';
      if (!rows.length) return;
      const first = rows[0];
      const items = [
        { label: 'القسط الشهري', value: fmt0.format(monthlyPayment) },
        { label: 'القسط السنوي', value: fmt0.format(annualPayment) },
        { label: 'NOI قبل القسط', value: fmt0.format(first.NOI) },
        { label: 'DSCR', value: fmt2.format(first.dscr) },
        { label: 'Break-even rent (شهري)', value: first.breakEvenMonthly ? fmt0.format(first.breakEvenMonthly) : '—' },
        { label: 'صافي الربح الشهري', value: fmt0.format(first.netProfitMonthly) },
        { label: 'العائد على المقدم', value: fmt2.format(first.returnOnDown * 100) + '%' },
      ];

      items.forEach(item => {
        const div = document.createElement('div');
        div.className = 'item';
        const label = document.createElement('div');
        label.className = 'label';
        label.textContent = item.label;
        const value = document.createElement('div');
        value.className = 'value';
        value.textContent = item.value;
        div.appendChild(label);
        div.appendChild(value);
        summaryGrid.appendChild(div);
      });

      const good = first.dscr >= DSCR_THRESHOLD && first.netProfitMonthly > 0;
      decisionEl.className = 'decision ' + (good ? 'good' : 'bad');
      decisionEl.textContent = good ? 'ناجح' : 'غير مناسب';
      const badge = document.createElement('span');
      badge.className = 'pill';
      badge.textContent = `DSCR ≥ ${DSCR_THRESHOLD}`;
      decisionEl.appendChild(badge);
    }

    function renderTable(rows) {
      resultsTableBody.innerHTML = '';
      rows.forEach(r => {
        const tr = document.createElement('tr');
        const cells = [
          r.year,
          fmt0.format(r.price),
          fmt0.format(r.rentAnnual),
          fmt0.format(r.rentMonthly),
          fmt0.format(r.annualPayment),
          fmt0.format(r.monthlyPayment),
          fmt0.format(r.netProfitAnnual),
          fmt0.format(r.netProfitMonthly),
          fmt2.format(r.returnOnDown * 100) + '%',
          fmt0.format(r.NOI),
          fmt2.format(r.dscr),
          r.breakEvenMonthly ? fmt0.format(r.breakEvenMonthly) : '—',
          fmt0.format(r.safetyMonthly),
        ];
        cells.forEach((val, idx) => {
          const td = document.createElement('td');
          td.textContent = val;
          if ([4,6,8,9].includes(idx)) td.classList.add('compact-hidden');
          tr.appendChild(td);
        });
        resultsTableBody.appendChild(tr);
      });
    }

    function updateComputedDisplays(loanAmount, rateAnnual) {
      loanAmountEl.textContent = fmt0.format(loanAmount);
      monthlyInterestEl.textContent = fmt0.format(computeMonthlyInterest(loanAmount, rateAnnual));
    }

    function triggerRecalc() {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        const vals = collectValues();
        if (!downLocked) {
          syncDownPaymentFromPct();
          vals.downPayment = getInputValue('downPayment');
        }
        const { rows, loanAmount, monthlyPayment, annualPayment } = computeRows(vals);
        renderSummary(rows, Math.abs(monthlyPayment), Math.abs(annualPayment), vals.downPayment);
        renderTable(rows);
        updateComputedDisplays(loanAmount, vals.rateAnnual);
      }, debounceDelay);
    }

    function exportCSV(rows) {
      if (!rows.length) return;
      const headers = [
        'العام','قيمة العقار','الإيجار السنوي','الإيجار الشهري','القسط السنوي','القسط الشهري','صافي الربح السنوي','صافي الربح الشهري','العائد على المقدم','NOI قبل القسط','DSCR','Break-even rent','هامش الأمان الشهري'
      ];
      const lines = [headers.join(',')];
      rows.forEach(r => {
        lines.push([
          r.year,
          r.price,
          r.rentAnnual,
          r.rentMonthly,
          r.annualPayment,
          r.monthlyPayment,
          r.netProfitAnnual,
          r.netProfitMonthly,
          r.returnOnDown * 100,
          r.NOI,
          r.dscr,
          r.breakEvenMonthly ?? '',
          r.safetyMonthly,
        ].map(v => typeof v === 'number' ? v.toFixed(2) : v).join(','));
      });
      const blob = new Blob([lines.join('\n')], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'investment-forecast.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    function attachEvents() {
      inputsGrid.addEventListener('input', (e) => {
        const key = e.target.dataset.key;
        if (!key) return;
        if (key === 'downPct' && !downLocked) {
          syncDownPaymentFromPct();
        }
        if (key === 'price0') {
          if (!downLocked) {
            syncDownPaymentFromPct();
          } else {
            syncDownPctFromPayment();
          }
        }
        if (key === 'downPayment' && downLocked) {
          syncDownPctFromPayment();
        }
        triggerRecalc();
      });

      exportBtn.addEventListener('click', () => {
        const vals = collectValues();
        const { rows } = computeRows(vals);
        exportCSV(rows);
      });

      resetBtn.addEventListener('click', () => {
        fieldsConfig.forEach(({ key }) => {
          const el = document.getElementById(key);
          el.value = defaults[key];
        });
        downLocked = false;
        const lockBtn = document.getElementById('lockBtn');
        if (lockBtn) {
          lockBtn.textContent = 'قفل الدفعة الأولى';
          document.getElementById('downPayment').disabled = true;
        }
        triggerRecalc();
      });

      switcher.addEventListener('click', (e) => {
        if (e.target.tagName !== 'BUTTON') return;
        switcher.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
        e.target.classList.add('active');
        const view = e.target.dataset.view;
        if (view === 'compact') {
          tableWrapper.classList.add('compact');
        } else {
          tableWrapper.classList.remove('compact');
        }
      });
    }

    function init() {
      createInputs();
      attachEvents();
      syncDownPaymentFromPct();
      triggerRecalc();
    }

    init();
  </script>
</body>
</html>
